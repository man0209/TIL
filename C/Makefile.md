# Makefile
- 리눅스상에서 반복적으로 발생하는 컴파일을 쉽게하기위해서 사용하는 make 프로그램의 설정 파일이다.
- Makefile을 통하여 library 및 컴파일 환경을 관리 할 수 있다.

# 오브젝트 파일(*.o)들을 정적 라이브러리 파일 (*.a, *lib)로 만들어서 사용하면 좋은 점
- 오브젝트 파일에 존재하는 함수를 하나라도 사용한다면, 빌드할 때 오브젝트 파일의 모든 코드를 가져와 하나의 파일로 빌드된다.
- 하지만 오브젝트 파일들을 정적 라이브러리로 만들게되면, 사용하고 있는 오브젝트 코드만 가져와 하나의 파일로 빌드된다.
- 즉 정적 라이브러리가 아닌 오브젝트 파일을 쓰게 된다면 사용하지도 않는 오브젝트 코드들도 모두 함께 빌드되어버린다.
- 때문에 파일의 크기가 커지고 느려진다.
- 오브젝트 파일이 아닌 정적 라이브러리 파일을 쓰도록 하자.

# 변수
- 변수를 사용하기 위해서는 $(CC) 와 같이 $() 안에 사용하고자 하는 변수의 이름을 지정하면 됩니다.
- $(OBJS:.o=.c) 부분은 OBJS 에서 .o 로 끝나는 부분을 .c 로 모두 대체하라는 의미 입니다.
- 
# 컴파일이란?
- 
# 기본 구조
- Makefile의 기본 구조는 매크로 정의, 룰, 명령어로 되어있다.
	- CC = gcc / 매크로 정의
	- target1 : dependency1 (space) dependency2    /룰1
		- (tab) command1 <br>
		- (tab) command2 /명령
	- target2 : dependency3 (space) dependency4    /룰2
		- (tab) command1 <br>
		- (tab) command2 /명령
	- command가 없이 타겟과 의존 관계만 표시가 되면 이는 타겟이 어느 파일에 의존하고 있는지 표시해 주는 정보의 역할을 한다.
- 패턴 규칙 문법
	```
	%.o : %.c
		recipe
	- %.o 는 와일드카드로 따지면 마치 *.o 와 같다고 볼 수 있습니다.
	- 즉, .o 로 끝나는 파일 이름들이 타겟이 될 수 있겠지요. 
	- 예를 들어서 foo.o 가 타겟이라면 % 에는 foo 가 들어갈 것이고 bar.o 의 경우 % 에는 bar 가 들어갈 것입니다.
	- 참고로 패턴은 target 과 dependency에만 사용 가능하다.
	
	%.o : %.c
		gcc -Werror -Wall -Wextra -c $< -o $@
	```

# Makefile에서의 매크로의 종류 (여기서는 C만)
- CC = 컴파일러를 변경할 때 사용. 리눅스에서는 gcc
- CFLAGS = gcc의 옵션을 추가 할 때 사용한다. ex) -werror -wextra ...
- DEFS = Define 추가 할 때 사용한다.

# 정적 라이브러리(Static Library)
- 리눅스에서는 *.a, 윈도우에서는 *.lib
- 라이브러리를 static하게 만든다는 것은 링킹(linking)단계에서 라이브러리 파일을 실행 바이너리에 포함 시킨다는 이야기이다.
	- a.out -> 바이너리 파일이니까 실행 바이너리에 포함 시킨다는 것은 a.out에 포함 시킨다는 의미가 아닐까?
- 즉 라이브러리의 동작 코드가 모두 실행 바이너리에 포함되어 있어 별도의 추가적인 작업 없이 실행 바이너리만으로 라이브러리 함수들을 사용할 수 있다.
- 하지만 라이브러리가 동시에 여러 실행 바이너리에 포함되어 실행되는 경우 메인 메모리 공간 활용 효율이 떨어지며, 정적 라이브러리를 사용하는 프로그램이 늘어날수록 불필요하게 실행 파일들의 크기가 커지는 등의 문제가 있다. 이를 보완하는 게 동적 라이브러리.

# ar(아카이브)
- 기록보관소? 여기서는 .o(오브젝트) 파일들을 하나로 묶어 정적 라이브러리(리눅스에선 .a)로 만들기 위한 명령어. 
- ar crsu [라이브러리 이름] [오브젝트 파일들]
	- r : 새로운 오브젝트 파일이면 추가, 기존 파일이면 치환.
	- c : 아카이브(라이브러리 파일) 생성, 존재하지 않는 아카이브를 작성(또는 갱신)하는 경우에도 경고 메시지를 출력하지 않음.
	- u : 오브젝트 파일의 타임스탬프를 비교해 새로운 파일일 경우에만 치환.
	- s : 아카이브 인덱스 생성. 아카이브 인덱스를 생성하지 않으면 링크 속도가 느려지고, 시스템 환경에 따라 에러가 발생할 수도 있음.


# 자동 변수
- 자동 변수는 레시피에서 사용할 수 있도록 make에 기본적으로 내장되어 있는 편리한 변수.
- 주요 자동 변수
	- $@ : 규칙의 목표 파일의 파일 이름입니다.
	- $< : 첫 번째 의존성의 이름입니다.
	- $? : 목표 파일보다 새로운 모든 의존성의 이름(사이에 공백이 있음)입니다.
	- $^ : 모든 전제 조건의 이름입니다(사이에 공백이 있음).

# all
- target 룰이 all 보다 위에 있으면 해당 target룰 한개만 실행되고 Make는 종료된다.
- 따라서 all 이 target 룰 보다 위에 있도록 하자.

# gcc -c
- .o(오브젝트 파일)만 만들고 컴파일을 멈춘다.

